# Инструкция по развертыванию фронтенда CRM-системы

## Обзор

Этот документ содержит пошаговые инструкции по развертыванию фронтенда CRM-системы VIPАвто. Фронтенд представляет собой React-приложение, которое взаимодействует с бэкендом через API.

## Предварительные требования

- Node.js (версия 16.x или выше)
- npm (версия 8.x или выше)
- Доступ к репозиторию проекта
- Учетная запись на Render.com (для развертывания)

## Настройка локального окружения

### 1. Клонирование репозитория

```bash
git clone <https://github.com/GautamaBTC/electric-service-crm>
cd CRM_VIPAUTO
```

### 2. Установка зависимостей

```bash
# Установка зависимостей корневого проекта
npm install

# Установка зависимостей клиентской части
cd client
npm install
cd ..
```

### 3. Настройка переменных окружения

Создайте файл `.env` в корне проекта со следующими переменными:

```
NODE_ENV=development
PORT=3000
JWT_SECRET=your_jwt_secret
JWT_EXPIRES_IN=7d
DATABASE_URL=your_database_url
```

Для фронтенда создайте файл `client/.env`:

```
# URL API сервера для локальной разработки
REACT_APP_API_URL=http://localhost:3001
```

### 4. Настройка переменных окружения для production

При развертывании на Render необходимо установить переменную окружения `REACT_APP_API_URL` со значением URL вашего бэкенда. Это можно сделать в файле `render.yaml`:

```yaml
envVars:
  # Другие переменные окружения...
  - key: REACT_APP_API_URL
    value: https://electric-service-crm-backend.onrender.com
```

Эта переменная будет использоваться во фронтенде для отправки запросов к API-серверу. Важно, чтобы значение этой переменной было установлено на этапе сборки фронтенда, а не во время выполнения.

## Запуск в режиме разработки

### 1. Запуск бэкенда

```bash
cd server
node index.js
```

### 2. Запуск фронтенда (в отдельном терминале)

```bash
cd client
npm start
```

Фронтенд будет доступен по адресу: http://localhost:3001

## Развертывание на Render.com

### 1. Подготовка к развертыванию

Убедитесь, что в файле `render.yaml` настроены все необходимые параметры:

- Сервисы (web и база данных)
- Команды сборки и запуска
- Переменные окружения

### 2. Настройка подключения к API

В файле `client/package.json` убедитесь, что указан правильный прокси-адрес:

```json
"proxy": "https://electric-service-crm-backend.onrender.com"
```

В файле `client/src/services/authService.js` проверьте, что baseURL API настроен корректно:

```javascript
const API_URL = process.env.REACT_APP_API_URL || '/api';
```

### 3. Сборка фронтенда

```bash
cd client
npm run build
```

Эта команда создаст директорию `build` с оптимизированными файлами для production.

### 4. Развертывание на Render

1. Зайдите в свою учетную запись на Render.com
2. Нажмите "New +" и выберите "Blueprint"
3. Подключите ваш репозиторий GitHub
4. Выберите файл `render.yaml` в качестве конфигурации
5. Нажмите "Apply"

Render автоматически выполнит следующие шаги:
- Установит зависимости проекта
- Соберет фронтенд
- Запустит сервер с обслуживанием статических файлов

### 5. Проверка развертывания

После завершения развертывания ваше приложение будет доступно по URL, который Render назначит вашему сервису.

## Тестирование работоспособности фронтенда

### 1. Проверка базовой функциональности

1. Откройте URL вашего приложения в браузере
2. Убедитесь, что загружается страница входа
3. Попробуйте войти в систему с тестовыми учетными данными

### 2. Проверка подключения к API

1. Откройте инструменты разработчика в браузере (F12)
2. Перейдите на вкладку "Network"
3. Попробуйте выполнить действие, требующее запроса к API (например, вход в систему)
4. Убедитесь, что запросы отправляются на правильный URL и возвращают ожидаемые ответы

### 3. Проверка маршрутизации

Убедитесь, что все маршруты работают корректно:
- `/login` - страница входа
- `/register` - страница регистрации
- `/dashboard` - дашборд (требуется аутентификация)
- `/orders` - список заказов (требуется аутентификация)
- `/masters` - список мастеров (требуется аутентификация и соответствующие права)
- `/settings` - настройки (требуется аутентификация и соответствующие права)
- `/bonuses` - бонусы (требуется аутентификация)
- `/stats` - статистика (требуется аутентификация и соответствующие права)
- `/profile` - профиль пользователя (требуется аутентификация)

### 4. Проверка адаптивности

Проверьте отображение приложения на различных устройствах:
- Десктоп (1920x1080, 1366x768)
- Планшет (768x1024, 1024x768)
- Мобильный телефон (375x667, 414x736)

## Обслуживание и обновление

### 1. Обновление зависимостей

```bash
cd client
npm update
```

### 2. Обновление приложения

1. Внесите необходимые изменения в код
2. Запушьте изменения в репозиторий
3. Render автоматически выполнит повторное развертывание

### 3. Откат версии

Если после обновления возникли проблемы:

1. Зайдите в панель управления Render
2. Выберите ваш сервис
3. Перейдите на вкладку "Deploys"
4. Найдите успешную версию и нажмите "Rollback"

## Решение распространенных проблем

### 1. Проблемы с подключением к API

**Симптомы:** Ошибки в консоли браузера, связанные с CORS или невозможностью подключения к API.

**Решение:**
- Убедитесь, что в `client/package.json` указан правильный прокси
- Проверьте, что в `client/src/services/authService.js` корректно настроен baseURL
- Убедитесь, что бэкенд развернут и доступен по указанному URL

### 2. Проблемы со сборкой

**Симптомы:** Ошибки во время выполнения команды `npm run build`.

**Решение:**
- Проверьте наличие всех зависимостей в `client/package.json`
- Убедитесь, что у вас установлена правильная версия Node.js
- Проверьте код на наличие синтаксических ошибок

### 3. Проблемы с маршрутизацией

**Симптомы:** Страницы не отображаются или отображаются некорректно при обновлении.

**Решение:**
- Убедитесь, что в `server/index.js` настроена обработка маршрутов для фронтенда
- Проверьте, что все маршруты определены в `client/src/App.js`
- Убедитесь, что используется BrowserRouter из react-router-dom

## Контакты

Если у вас возникли вопросы или проблемы, связанные с развертыванием фронтенда, пожалуйста, свяжитесь с командой разработки.

---

*Последнее обновление: 16 февраля 2026 г.*